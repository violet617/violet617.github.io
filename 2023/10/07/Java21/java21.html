<hr>
<p>title: Java21新特性和改进<br>tags:</p>
<ul>
<li>java</li>
<li>jvm<br>categories:</li>
<li>折腾记录<br>date: 2023-10-07 10:46:24<br>cover:</li>
</ul>
<hr>
<div id="content_views" class="htmledit_views">
                    <p>JDK21 计划23年9月19日正式发布，虽然一直以来都是“版本随便出，换 8 算我输”，但这么多年这么多版本的折腾，如果说之前的 <a href="https://so.csdn.net/so/search?q=LTS&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=LTS&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;LTS\&quot;}&quot;}" data-tit="LTS" data-pretit="lts">LTS</a>版本JDK17你还觉得不香，那 JDK21还是有必要关注一下，因为会有一批重要更新发布到生产环境中，特别是千呼万唤的虚拟线程，虽然说这东西我感觉不需要的用不到，需要的早都转go了，哈哈，但作为近几年JDK一个“重大”的更新，在实际开发应用中还是是有很大价值的。所以这篇文章主要提取了这次更新中个人感觉比较有价值的几点做个基本的介绍，想要尝鲜的同学可以看下。</p> 
<h2><a name="t0"></a>Visual Threads （虚拟线程） -JEP 444</h2> 
<p>先看下官方对虚拟线程（Visual Threads）描述：</p> 
<blockquote> 
 <p>Today, every instance of&nbsp;<code>java.lang.Thread</code>&nbsp;in the JDK <a href="https://so.csdn.net/so/search?q=is&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=is&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;is\&quot;}&quot;}" data-tit="is" data-pretit="is">is</a> a&nbsp;platform thread. A platform thread runs Java code on an underlying OS thread and captures the OS thread for the code's entire lifetime. The number of platform threads is limited to the number of OS threads.</p> 
 <p>A&nbsp;virtual thread&nbsp;is an instance of&nbsp;<code>java.lang.Thread</code>&nbsp;that runs Java code on an underlying OS thread but does not capture the OS thread for the code's entire lifetime. This means that many virtual threads can run their Java code on the same OS thread, effectively sharing it. While a platform thread monopolizes a precious OS thread, a virtual thread does not. The number of virtual threads can be much larger than the number of OS threads.</p> 
 <p>Virtual threads are a lightweight implementation of threads that is provided by the JDK rather than the OS. They are a form of&nbsp;user-mode threads, which have been successful in other multithreaded languages (e.g., goroutines in Go and processes in Erlang). User-mode threads even featured as so-called&nbsp;"green threads"&nbsp;in early versions of Java, when OS threads were not yet mature and widespread. However, Java's green threads all shared one OS thread (M:1 scheduling) and were eventually outperformed by platform threads, implemented as wrappers for OS threads (1:1 scheduling). Virtual threads employ M:N scheduling, where a large number (M) of virtual threads is scheduled to run on a smaller number (N) of OS threads.</p> 
</blockquote> 
<p>总结下就是之前java中的线程是“platform thread”即平台线程，它由操作系统线程为基础，按照1:1的模式调度，这导致线程的创建与执行都是很耗资源的，同时数量也受系统的约束；但新的虚拟线程则是由JDK提供，你可以把它看作是在平台线程基础上创建的“一批”线程，它们有效地共享所属的平台线程也就是操作系统线程的资源，从而提升系统利用率，并不受数量限制。</p> 
<p>目标描述：</p> 
<blockquote> 
 <p>1、Enable server applications written in the simple thread-per-request style to scale with near-optimal hardware utilization.</p> 
 <p>可以每个请求开启一个虚拟线程，实现简单直接的同时可以最大程度的提升硬件利用率；</p> 
 <p>2、Enable existing code that uses the&nbsp;<code>java.lang.Thread</code>&nbsp;API to adopt virtual threads with minimal change.</p> 
 <p>之前的多线程实现代码可以在较小的改动下完成向虚拟线程的迁移；</p> 
 <p>3、Enable easy troubleshooting, debugging, and profiling of virtual threads with existing JDK tools.</p> 
 <p>使用现有JDK工具可以完成虚拟线程的代码调试、分析与问题定位；</p> 
</blockquote> 
<p>说白了就是现在我们不用怎么改代码就可以创建一个轻量级的虚拟线程，实现简单同时还能够充分发挥硬件性能。</p> 
<p>一个简单的代码示例</p> 
<pre data-index="0"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">try&nbsp;(var&nbsp;executor&nbsp;<span class="hljs-operator">=</span>&nbsp;Executors.newVirtualThreadPerTaskExecutor())&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;IntStream.range(<span class="hljs-number">0</span>,&nbsp;<span class="hljs-number">10000</span>).forEach(i&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executor.submit(()&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(Duration.ofSeconds(<span class="hljs-number">1</span>));</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;i;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;});</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}&nbsp;&nbsp;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&nbsp;executor.<span class="hljs-keyword">close</span>()&nbsp;<span class="hljs-keyword">is</span>&nbsp;called&nbsp;implicitly,&nbsp;<span class="hljs-keyword">and</span>&nbsp;waits</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t1"></a>SequencedCollection Interface（顺序集合 接口）</h2> 
<p> 相比上面的虚拟线程，这次关于集合类接口的更新我感觉更实在一些</p> 
<p>JDK21中我们常用的Set、List、Deque与Map集合类分别继承实现了SequencedCollection、 SequencedMap 接口，为我们执行一些顺序性操作比如获取头尾值提供了各类接口方法</p> 
<p>继承关系如下图所示：</p> 
<p></p> 
<p class="img-center"><img  src="https://cdn.jsdelivr.net/gh/violet617/ImgBed@main/ztNotes/20231007105335.png"></p> 
<p>接口定义如下</p> 
<pre data-index="1"><code class="hljs language-csharp"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">interface</span>&nbsp;<span class="hljs-title">SequencedCollection</span>&lt;<span class="hljs-title">E</span>&gt;&nbsp;<span class="hljs-title">extends</span>&nbsp;<span class="hljs-title">Collection</span>&lt;<span class="hljs-title">E</span>&gt;&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;new&nbsp;method</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">SequencedCollection&lt;E&gt;&nbsp;<span class="hljs-title">reversed</span>()</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;methods&nbsp;promoted&nbsp;from&nbsp;Deque</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">addFirst</span>(<span class="hljs-params">E</span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">addLast</span>(<span class="hljs-params">E</span>)</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">E&nbsp;<span class="hljs-title">getFirst</span>()</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">E&nbsp;<span class="hljs-title">getLast</span>()</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">E&nbsp;<span class="hljs-title">removeFirst</span>()</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function">E&nbsp;<span class="hljs-title">removeLast</span>()</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<pre data-index="2"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">interface</span>&nbsp;SequencedSet<span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span>&nbsp;extends&nbsp;<span class="hljs-keyword">Set</span><span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span>,&nbsp;SequencedCollection<span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;SequencedSet<span class="hljs-operator">&lt;</span>E<span class="hljs-operator">&gt;</span>&nbsp;reversed();&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&nbsp;covariant&nbsp;<span class="hljs-keyword">override</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<pre data-index="3"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">interface</span>&nbsp;SequencedMap<span class="hljs-operator">&lt;</span>K,V<span class="hljs-operator">&gt;</span>&nbsp;extends&nbsp;Map<span class="hljs-operator">&lt;</span>K,V<span class="hljs-operator">&gt;</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&nbsp;new&nbsp;methods</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;SequencedMap<span class="hljs-operator">&lt;</span>K,V<span class="hljs-operator">&gt;</span>&nbsp;reversed();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;SequencedSet<span class="hljs-operator">&lt;</span>K<span class="hljs-operator">&gt;</span>&nbsp;sequencedKeySet();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;SequencedCollection<span class="hljs-operator">&lt;</span>V<span class="hljs-operator">&gt;</span>&nbsp;sequencedValues();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;SequencedSet<span class="hljs-operator">&lt;</span>Entry<span class="hljs-operator">&lt;</span>K,V<span class="hljs-doctag">&gt;&gt;&nbsp;sequencedEntrySet();</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;putFirst(K,&nbsp;V);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;putLast(K,&nbsp;V);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>&nbsp;methods&nbsp;promoted&nbsp;<span class="hljs-keyword">from</span>&nbsp;NavigableMap</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;Entry<span class="hljs-operator">&lt;</span>K,&nbsp;V<span class="hljs-operator">&gt;</span>&nbsp;firstEntry();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;Entry<span class="hljs-operator">&lt;</span>K,&nbsp;V<span class="hljs-operator">&gt;</span>&nbsp;lastEntry();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;Entry<span class="hljs-operator">&lt;</span>K,&nbsp;V<span class="hljs-operator">&gt;</span>&nbsp;pollFirstEntry();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;Entry<span class="hljs-operator">&lt;</span>K,&nbsp;V<span class="hljs-operator">&gt;</span>&nbsp;pollLastEntry();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<2><a name="t2"></a>Record Patterns （记录模式）-JEP 440</h2> 
<p>这个更新主要简化了类型判断与赋值的使用，类型判断后无需显式强制转换且如果模式匹配，变量被初始化为要匹配的模板值， 这个说起来比较拗口，结合代码大家理解下，我感觉还是挺有用的，这里我把JDK8 <a href="https://so.csdn.net/so/search?q=JDK17&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=JDK17&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;JDK17\&quot;}&quot;}" data-tit="JDK17" data-pretit="jdk17">JDK17</a> JDK21 的实现进行一个对比，大家就明白了。</p> 
<pre data-index="4"><code class="hljs language-java"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//&nbsp;As&nbsp;of&nbsp;Java&nbsp;8</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">record</span>&nbsp;<span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span>&nbsp;x,&nbsp;<span class="hljs-type">int</span>&nbsp;y)</span>&nbsp;{}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title function_">printSum</span><span class="hljs-params">(Object&nbsp;obj)</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(obj&nbsp;<span class="hljs-keyword">instanceof</span>&nbsp;Point)&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-type">Point</span>&nbsp;<span class="hljs-variable">p</span>&nbsp;<span class="hljs-operator">=</span>&nbsp;(Point)&nbsp;obj;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-type">int</span>&nbsp;<span class="hljs-variable">x</span>&nbsp;<span class="hljs-operator">=</span>&nbsp;p.x();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-type">int</span>&nbsp;<span class="hljs-variable">y</span>&nbsp;<span class="hljs-operator">=</span>&nbsp;p.y();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(x+y);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<pre data-index="5"><code class="hljs language-java"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//&nbsp;As&nbsp;of&nbsp;Java&nbsp;16</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">record</span>&nbsp;<span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span>&nbsp;x,&nbsp;<span class="hljs-type">int</span>&nbsp;y)</span>&nbsp;{}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"> </div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title function_">printSum</span><span class="hljs-params">(Object&nbsp;obj)</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(obj&nbsp;<span class="hljs-keyword">instanceof</span>&nbsp;Point&nbsp;p)&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-type">int</span>&nbsp;<span class="hljs-variable">x</span>&nbsp;<span class="hljs-operator">=</span>&nbsp;p.x();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-type">int</span>&nbsp;<span class="hljs-variable">y</span>&nbsp;<span class="hljs-operator">=</span>&nbsp;p.y();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(x+y);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<pre data-index="6"><code class="hljs language-csharp"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-comment">//&nbsp;As&nbsp;of&nbsp;Java&nbsp;21</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">printSum</span>(<span class="hljs-params">Object&nbsp;obj</span>)</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(<span class="hljs-function">obj&nbsp;instanceof&nbsp;<span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span>&nbsp;x,&nbsp;<span class="hljs-built_in">int</span>&nbsp;y</span>))</span>&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.<span class="hljs-keyword">out</span>.println(x+y);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t3"></a>Pattern Matching for switch （switch模式匹配） – JEP 441</h2> 
<p>switch 的模式匹配可以与Record Patterns结合使用 允许在任何对象上制定 switch 语句和表达式。看一下代码例子：</p> 
<pre data-index="7"><code class="hljs language-cobol"><ol class="hljs-ln" style="width:774px"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">static&nbsp;<span class="hljs-keyword">String</span>&nbsp;formatterPatternSwitch(<span class="hljs-keyword">Object</span>&nbsp;obj)&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;switch&nbsp;(obj)&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Integer&nbsp;i&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;<span class="hljs-keyword">String</span>.<span class="hljs-keyword">format</span>(<span class="hljs-string">"int&nbsp;%d"</span>,&nbsp;i);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Long&nbsp;l&nbsp;&nbsp;&nbsp;&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;<span class="hljs-keyword">String</span>.<span class="hljs-keyword">format</span>(<span class="hljs-string">"long&nbsp;%d"</span>,&nbsp;l);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Double&nbsp;d&nbsp;&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;<span class="hljs-keyword">String</span>.<span class="hljs-keyword">format</span>(<span class="hljs-string">"double&nbsp;%f"</span>,&nbsp;d);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;<span class="hljs-keyword">String</span>&nbsp;s&nbsp;&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;<span class="hljs-keyword">String</span>.<span class="hljs-keyword">format</span>(<span class="hljs-string">"String&nbsp;%s"</span>,&nbsp;s);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;Position(int&nbsp;x,&nbsp;int&nbsp;y)&nbsp;&nbsp;&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;<span class="hljs-keyword">String</span>.<span class="hljs-keyword">format</span>(<span class="hljs-string">"String&nbsp;%s,String&nbsp;%s"</span>,&nbsp;x,y);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-<span class="hljs-operator">&gt;</span>&nbsp;obj.toString();</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;};</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>同时当编译器判断所有分支都已涵盖时，switch不再需要分支<code>default</code>，如下面的代码</p> 
<pre data-index="8"><code class="hljs language-csharp"><ol class="hljs-ln" style="width:100%"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">flyJava21</span>(<span class="hljs-params">Direction&nbsp;direction</span>)</span>&nbsp;{&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">switch</span>&nbsp;(direction)&nbsp;{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;CompassDirection.NORTH&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Flying&nbsp;north"</span>);&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;CompassDirection.SOUTH&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Flying&nbsp;south"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;CompassDirection.EAST&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Flying&nbsp;east"</span>);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;CompassDirection.WEST&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Flying&nbsp;west"</span>);&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;VerticalDirection.UP&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Gaining&nbsp;altitude"</span>);&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">case</span>&nbsp;VerticalDirection.DOWN&nbsp;-&gt;&nbsp;System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"Losing&nbsp;altitude"</span>);&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<h2><a name="t4"></a>Generational ZGC（分代式 ZGC） -JEP 439</h2> 
<p>主要是增加了对分代的支持，提高垃圾回收的性能，看下整体描述</p> 
<blockquote> 
 <p>To ensure a smooth succession, we will initially make Generational ZGC available alongside non-generational ZGC. The&nbsp;<code>-XX:+UseZGC</code>&nbsp;command-line option will select non-generational ZGC; to select Generational ZGC, add the&nbsp;<code>-XX:+ZGenerational</code>&nbsp;option:</p> 
</blockquote> 
<p>使用命令行选项 -XX:+UseZGC 将选择非分代式 ZGC；要选择分代式 ZGC，需要添加 -XX:+ZGenerational 选项。</p> 
<pre data-index="9"><code class="hljs language-ruby"><span class="hljs-variable">$&nbsp;</span>java&nbsp;-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+UseZGC</span>&nbsp;-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+ZGenerational</span>&nbsp;...</code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<blockquote> 
 <p>In a future release we intend to make Generational ZGC the default, at which point&nbsp;<code>-XX:-ZGenerational</code>&nbsp;will select non-generational ZGC. In an even later release we intend to remove non-generational ZGC, at which point the&nbsp;<code>ZGenerational</code>&nbsp;option will become obsolete.</p> 
</blockquote> 
<p>总结就是当前版本中如果想使用ZGC，命令行选项增加 -XX:+UseZGC，但默认是非分代式GC；要使用分代式ZGC ，需要改为 $ java -XX:+UseZGC -XX:+ZGenerational ，而在后续的版本中会默认改为分代GC。</p> 
<p>以上就是JDK21版本中我感觉一些有价值的更新，如果大家希望能够更进一步的了解还是要去官网https://openjdk.org/projects/jdk/21/ 自行查看，并在发布之后在使用中实际验证。</p> 
<p>之所以有这次总结，主要还是有感于java近年来受到其他各类语言的冲击，颇有垂垂老矣的感觉，让我这个C#出身的javaer又想起了一段不好的回忆，哈哈，所以看看这次的更新是否能给点力， 当前java语言的下行趋势也可以说是国内IT行业兴衰起伏的一个侧面写照，当然作为一个提供生产力的编程语言，围绕java建立起的整个完整、稳定、强大的生态仍然会在它适合的领域起到重要的作用，这是一时半会无法改变的，但你指望靠它干到退休估计连收了学费的培训机构也不敢这样说，程序员的职业寿命从来不是某种编程语言决定的。最后我还是想说入行的菜鸟才纠结于语言优劣，成熟老手知道这早有定论，让我们大声喊出：<code>&nbsp; &nbsp;</code></p> 
<pre data-index="10"><code class="hljs language-csharp">                                   &nbsp; <span class="hljs-string">"PHP是最好的语言"</span></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p>这不是玩梗，因为从某种角度上讲：&nbsp;</p> 
<pre data-index="11"><code class="hljs language-csharp">&nbsp;&nbsp;&nbsp;&nbsp;                            &nbsp;<span class="hljs-string">"生产力才是决定语言生死的关键"</span></code><div class="hljs-button {2}" data-title="复制" onclick="hljs.copyCode(event)"></div></pre> 
<p><a href="https://openjdk.org/projects/jdk/21/" title="参考资料： JDK 21">参考资料： JDK 21</a>&nbsp;</p>
                </div>